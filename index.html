<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Ether Dome</title>

<style>
:root{
  --card-pad: 2rem;
  --title-size: 1.7rem;
  --body-size: 1.05rem;
  --line: 1.8;
}

body{
  margin:0;
  font-family: Georgia, serif;
  background:#0c0a07 url("assets/img/dome.png") center/cover no-repeat fixed;
  color:#e6d8b5;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding:2rem 1rem;
}

#game{
  width:min(760px, 100%);
}

.card{
  background:rgba(0,0,0,.78);
  border:1px solid rgba(200,150,60,.4);
  padding:var(--card-pad);
  border-radius:8px;
  backdrop-filter: blur(4px);
}

h1{
  font-size:var(--title-size);
  margin-top:0;
  font-weight:400;
}

.narrator{
  font-size:var(--body-size);
  line-height:var(--line);
  margin-bottom:2rem;
}

img.portrait{
  width:100%;
  max-width:340px;
  display:block;
  margin:0 auto 1.5rem auto;
  border:1px solid rgba(200,150,60,.4);
  display:none;
}

button{
  display:block;
  width:100%;
  margin:.5rem 0;
  padding:.7rem;
  background:#1a140a;
  color:#e6d8b5;
  border:1px solid rgba(200,150,60,.4);
  cursor:pointer;
}

button:hover{
  background:#2a1e0c;
}

.hud{
  position:fixed;
  top:10px;
  right:10px;
}

.toggle{
  background:#1a140a;
  color:#e6d8b5;
  border:1px solid rgba(200,150,60,.4);
  padding:.4rem .7rem;
  cursor:pointer;
}

@media (min-width:900px){
  body{align-items:center;}
}
</style>
</head>
<body>

<div id="game">
  <div class="card">
    <h1>The Ether Dome</h1>

    <img id="portrait" class="portrait" />

    <div class="narrator" id="text"></div>
    <div id="choices"></div>
  </div>
</div>

<div class="hud">
  <button class="toggle" id="audioToggle">Ambience OFF</button>
</div>

<audio id="mainAudio" src="assets/audio/main.mp3" loop preload="auto" playsinline></audio>
<audio id="sting" src="assets/audio/sting.mp3" preload="auto" playsinline></audio>

<script>
const textEl = document.getElementById("text");
const choicesEl = document.getElementById("choices");
const portraitEl = document.getElementById("portrait");
const mainAudio = document.getElementById("mainAudio");
const sting = document.getElementById("sting");
const toggle = document.getElementById("audioToggle");

let audioOn = false;

toggle.onclick = () => {
  audioOn = !audioOn;
  if(audioOn){
    mainAudio.currentTime = 0;
    mainAudio.play().catch(()=>{});
    toggle.innerText = "Ambience ON";
  } else {
    mainAudio.pause();
    toggle.innerText = "Ambience OFF";
  }
};

function typeText(text, callback){
  textEl.innerHTML = "";
  let i = 0;
  function typing(){
    if(i < text.length){
      textEl.innerHTML += text.charAt(i);
      i++;
      setTimeout(typing, 18);
    } else {
      if(callback) callback();
    }
  }
  typing();
}

function clearChoices(){
  choicesEl.innerHTML = "";
}

function choice(label, action){
  const btn = document.createElement("button");
  btn.innerText = label;
  btn.onclick = action;
  choicesEl.appendChild(btn);
}

function showPortrait(src){
  portraitEl.src = src;
  portraitEl.style.display = "block";
}

function hidePortrait(){
  portraitEl.style.display = "none";
}

function start(){
  hidePortrait();
  typeText(
  "Massachusetts General Hospital. Boston. October 16, 1846.\n\nThe Ether Dome waits like a chapel built for spectacle. Today, suffering is about to be negotiated chemically.",
  ()=>{
    choice("William Morton", mortonPath);
    choice("Charles Jackson", jacksonPath);
    choice("Horace Wells", wellsPath);
  });
}

function mortonPath(){
  clearChoices();
  showPortrait("assets/img/morton.png");
  typeText(
  "Morton inhales the sweet, sharp vapor and sees history bending toward him. The crowd holds its breath. The patient vanishes into stillness.",
  ()=>{
    sting.play().catch(()=>{});
    choice("Reset", start);
  });
}

function jacksonPath(){
  clearChoices();
  showPortrait("assets/img/jackson.png");
  typeText(
  "Jackson watches, jaw tight. \"I was right.\" The words never quite leave his mouth, but they echo all the same.",
  ()=>{
    sting.play().catch(()=>{});
    choice("Reset", start);
  });
}

function wellsPath(){
  clearChoices();
  showPortrait("assets/img/wells.png");
  typeText(
  "Wells remembers the laughter. The failure. The humiliation. And now this. No one is there to witness him as he fades to black one last time.",
  ()=>{
    sting.play().catch(()=>{});
    choice("Reset", start);
  });
}

start();
</script>

</body>
</html>
