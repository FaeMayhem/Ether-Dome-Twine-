<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Ether Dome — A Tale of Three Fates</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=IM+Fell+English:ital@0;1&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0e0c08;
    --parch:#f5edd8;
    --parch2:#e8d9bc;
    --gold:#8b6914;
    --fade:#6b5c3e;
    --card:rgba(15,12,8,0.74);
    --border:rgba(139,105,20,0.38);
    --wash-blue: rgba(70,120,150,0.12);
    --wash-amber: rgba(160,115,35,0.12);
    --wash-ash: rgba(190,190,190,0.10);
    --timing-short: 240ms;
    --timing-med: 550ms;
    --spacing-top: 3.1rem;
    --portrait-width: min(520px, 92%);
    --text-speed: 1;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    background: var(--bg);
    color: var(--parch);
    font-family: "IM Fell English", serif;
    min-height: 100vh;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding: 1.25rem 1rem 2rem;
    overflow-x:hidden;
  }
  body:before{
    content:"";
    position:fixed; inset:0;
    pointer-events:none;
    opacity:0.045;
    z-index:0;
    background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  }
  .vignette{
    position:fixed; inset:0;
    pointer-events:none;
    z-index:1;
    background: radial-gradient(ellipse at center, transparent 48%, rgba(0,0,0,0.75) 100%);
    opacity:0.95;
  }

  #topbar{
    position:fixed;
    top: 0.85rem;
    right: 0.85rem;
    z-index: 50;
    display:flex;
    gap:0.5rem;
    align-items:center;
  }
  .btn-small{
    background: transparent;
    border: 1px solid var(--border);
    color: var(--gold);
    font-family: "IM Fell English", serif;
    padding: 0.35rem 0.65rem;
    font-size: 0.78rem;
    cursor:pointer;
    letter-spacing:0.04em;
    transition: all 0.2s ease;
  }
  .btn-small:hover{ background: rgba(139,105,20,0.10); border-color: rgba(139,105,20,0.7); }
  .btn-small.muted{ opacity:0.45; }
  #game{
    width: min(760px, 100%);
    position:relative;
    z-index:2;
    margin-top: var(--spacing-top);
    animation: gameCardFade 1s ease-out;
  }
  @keyframes gameCardFade {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .card{
    background: var(--card);
    border: 1px solid rgba(139,105,20,0.28);
    box-shadow: 0 14px 40px rgba(0,0,0,0.35);
    border-radius: 14px;
    padding: 1.15rem 1.05rem;
    -webkit-backdrop-filter: blur(1px);
    backdrop-filter: blur(1px);
  }
  .location-tag{
    font-family: "Playfair Display", serif;
    font-size: 0.68rem;
    letter-spacing: 0.22em;
    text-transform: uppercase;
    color: var(--gold);
    opacity: 0.92;
    margin-bottom: 1.1rem;
  }
  h1{
    font-family: "Playfair Display", serif;
    font-weight: 400;
    font-style: italic;
    line-height: 1.15;
    margin-bottom: 0.85rem;
    font-size: 1.75rem;
  }
  @keyframes portraitFade {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .portrait{
    display:block;
    width: var(--portrait-width);
    height:auto;
    margin: 1.15rem auto 1.1rem;
    border-radius: 10px;
    box-shadow: 0 16px 35px rgba(0,0,0,0.32);
    border: 1px solid rgba(245,237,216,0.10);
    animation: portraitFade 0.6s ease-out;
    max-height: 70vh;
    object-fit: contain;
  }
  .wash{ position:relative; }
  .wash:after{
    content:"";
    position:absolute;
    inset:-6px;
    border-radius: 16px;
    pointer-events:none;
    opacity: 0;
    transition: opacity 600ms ease;
    background: var(--wash, transparent);
    mix-blend-mode: screen;
  }
  .wash.wash-on:after{ opacity: 1; }
  .narrator{
    font-size: 1.05rem;
    line-height: 1.65;
    color: var(--parch2);
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
  }
  .narrator em{ color: var(--parch); }
  .narrator .grim{ color:#c49a9a; font-style: italic; }
  .choices{
    margin-top: 1.35rem;
    display:flex;
    flex-direction:column;
    gap: 0.65rem;
    opacity: 0;
    transform: translateY(6px);
    transition: opacity var(--timing-med) ease, transform var(--timing-med) ease;
    clear: both;
    padding-top: 1rem;
    border-top: 1px solid rgba(139,105,20,0.15);
    min-height: 2rem;
  }
  .choices.visible{ opacity: 1; transform: translateY(0); }
  .choice-label{
    font-family:"Playfair Display", serif;
    font-size: 0.65rem;
    letter-spacing:0.2em;
    text-transform:uppercase;
    color: var(--fade);
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }
  button.choice{
    background: transparent;
    border: 1px solid var(--border);
    color: var(--parch);
    font-family:"IM Fell English", serif;
    font-size: 0.98rem;
    padding: 0.85rem 1.05rem;
    text-align:left;
    cursor:pointer;
    line-height:1.45;
    border-radius: 12px;
    transition: border-color 0.2s ease, background 0.2s ease, transform 0.08s ease, opacity 0.2s ease;
    position:relative;
    overflow:hidden;
    min-height: 3rem;
    display: flex;
    align-items: center;
  }
  button.choice:hover{ border-color: rgba(139,105,20,0.78); background: rgba(139,105,20,0.07); }
  button.choice:active{ transform: translateY(1px); }
  button.choice:disabled{ opacity: 0.5; cursor: default; }
  button.choice:before{
    content:"❧";
    color: var(--gold);
    margin-right: 0.55rem;
    opacity: 0;
    transition: opacity 0.18s ease;
  }
  button.choice:hover:before{ opacity: 1; }

  .hud{
    display:flex;
    justify-content: space-between;
    align-items:flex-start;
    gap: 0.75rem;
    padding: 0.65rem 0.7rem;
    border: 1px solid rgba(139,105,20,0.25);
    border-radius: 12px;
    background: rgba(0,0,0,0.18);
    margin-bottom: 0.95rem;
    opacity: 0;
    transform: translateY(-6px);
    transition: opacity 650ms ease, transform 650ms ease;
  }
  .hud.visible{ opacity: 1; transform: translateY(0); }
  .meter{ flex:1; }
  .meter .label{
    font-family:"Playfair Display", serif;
    font-size: 0.68rem;
    letter-spacing:0.18em;
    text-transform:uppercase;
    color: var(--gold);
    opacity:0.9;
    margin-bottom: 0.4rem;
    white-space: nowrap;
  }
  .bars{ display:flex; gap:6px; flex-wrap:nowrap; }
  .bar{
    width: 18px; height: 8px;
    border-radius: 999px;
    border: 1px solid rgba(139,105,20,0.35);
    background: rgba(139,105,20,0.12);
    transition: background 320ms ease, border-color 320ms ease;
  }
  .bar.filled{ background: rgba(139,105,20,0.85); border-color: rgba(139,105,20,0.9); }

  @media (max-width: 420px){
    h1{font-size:1.55rem}
    .narrator{font-size:1.01rem}
    .bar{width:16px}
  }
  @media (prefers-reduced-motion: reduce){
    .choices, .hud, .dome-bleed, .portrait{ transition:none !important; animation: none !important; }
  }

@media (min-width: 900px){
  body{align-items:center;}
}


/* Reveal chunks */
.para{margin:0 0 0.9rem 0;}
.line.fade{opacity:0; transition: opacity calc(7500ms / var(--text-speed)) ease; display: inline;}
.line.fade.in{opacity:1; transition: opacity calc(7500ms / var(--text-speed)) ease;}
button.continue{
  margin-top: 0.4rem;
  padding: 0.85rem 1rem;
  border-radius: 12px;
  border: 1px solid rgba(179,139,34,0.35);
  background: rgba(0,0,0,0.35);
  color: rgba(240,225,190,0.95);
  font: inherit;
}
button.continue:active{transform: translateY(1px);}

@media (max-width: 480px){
  #game{padding: 0.9rem;}
  #card{padding: 1rem;}
  #text{max-height: 50svh; margin-bottom: 4rem;}
  .portrait{max-height: 36svh;}
  .choices{ margin-top: 4rem; padding-top: 2.5rem; border-top: 2px solid rgba(139,105,20,0.35); }
}
</style>
</head>
<body>
<div class="dome-bleed" id="domeBleed"></div>
<div class="vignette"></div>

<div id="topbar">
  <div style="display: flex; align-items: center; gap: 0.5rem;">
    <label for="speedControl" style="font-size: 0.75rem; letter-spacing: 0.04em; color: var(--gold); opacity: 0.8; white-space: nowrap;">Text Speed</label>
    <input type="range" id="speedControl" min="0.5" max="2" step="0.25" value="1" 
      style="width: 70px; cursor: pointer; accent-color: var(--gold);" 
      title="Adjust text reveal speed (0.5x = slow, 1x = normal, 2x = fast)">
  </div>
  <button id="audioToggle" class="btn-small muted">♪ Ambience OFF</button>
</div>

<div id="game" class="card wash">
  <div id="hud" class="hud" aria-live="polite">
    <div class="meter">
      <div class="label" id="driveLabel">Drive</div>
      <div class="bars" id="driveBars"></div>
    </div>
    <div class="meter">
      <div class="label" id="fractureLabel">Fracture</div>
      <div class="bars" id="fractureBars"></div>
    </div>
  </div>

  <div class="location-tag" id="locationTag"></div>
  <h1 id="title"></h1>

  <img id="portrait" class="portrait" alt="" style="display:none;" />

  <div id="text" class="narrator" data-typewrite></div>

  <div id="choices" class="choices">
    <div class="choice-label" id="choiceLabel"></div>
    <div id="choiceButtons"></div>
  </div>
</div>

<script>
const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));

const State = {
  doctor:"none",
  drive:0,
  fracture:0,
  meterShown:false,
  labels:{drive:"Drive", fracture:"Fracture"}
};

function resetState(){
  State.doctor="none";
  State.drive=0;
  State.fracture=0;
  State.meterShown=false;
  State.labels={drive:"Drive", fracture:"Fracture"};
  setWash(null);
  setDomeBleed(0);
  hideHUD();
}

let audioEnabled=false;
let audioReady=false;
const music = new Audio("assets/audio/main.mp3");
const sting = new Audio("assets/audio/sting.mp3");
music.loop=true;
music.volume=0.55;
sting.volume=0.75;

// Error handling for audio files
[{el: music, name: "main"}, {el: sting, name: "sting"}].forEach(({el, name}) => {
  el.addEventListener('error', (e) => {
    console.warn(`Audio file "${name}" failed to load:`, e);
    el.dataset.failed = true;
  });
  el.addEventListener('canplay', () => {
    delete el.dataset.failed;
  });
});

function playAudio(audioEl) {
  if (audioEl.dataset.failed) {
    console.warn('Audio unavailable');
    return;
  }
  audioEl.currentTime = 0;
  audioEl.play().catch(err => {
    console.warn('Playback failed (may be mobile restriction):', err);
  });
}

function startAudioOnce(){
  if(audioReady) return;
  audioReady=true;
  if(audioEnabled){
    playAudio(music);
  }
}

// Gate audio unlock to first user interaction
["pointerdown","touchstart","mousedown","keydown"].forEach(ev=>{
  window.addEventListener(ev, startAudioOnce, {once:true, passive:true});
});


const audioBtn=document.getElementById("audioToggle");
audioBtn.addEventListener("click",()=>{
  audioEnabled=!audioEnabled;
  audioBtn.classList.toggle("muted",!audioEnabled);
  audioBtn.textContent = audioEnabled ? "♪ Ambience ON" : "♪ Ambience OFF";
  if(!audioEnabled){ 
    music.pause(); 
  }
  else { 
    startAudioOnce(); 
    playAudio(music);
  }
});

// Text speed control
const speedControl = document.getElementById("speedControl");
if(speedControl) {
  speedControl.addEventListener("input", (e) => {
    const speed = parseFloat(e.target.value);
    document.documentElement.style.setProperty("--text-speed", speed);
    window.textSpeed = speed;
  });
  // Initialize
  window.textSpeed = 1;
}

const elLocation=document.getElementById("locationTag");
const elTitle=document.getElementById("title");
const elText=document.getElementById("text");
const elChoices=document.getElementById("choices");
const elChoiceLabel=document.getElementById("choiceLabel");
const elChoiceButtons=document.getElementById("choiceButtons");
const elPortrait=document.getElementById("portrait");
const elHUD=document.getElementById("hud");
const elDriveLabel=document.getElementById("driveLabel");
const elFractureLabel=document.getElementById("fractureLabel");
const elDriveBars=document.getElementById("driveBars");
const elFractureBars=document.getElementById("fractureBars");
const domeBleed=document.getElementById("domeBleed");
const gameCard=document.getElementById("game");

function setWash(wash){
  gameCard.style.setProperty("--wash", wash || "transparent");
  gameCard.classList.toggle("wash-on", !!wash);
}
function setDomeBleed(opacity){
  domeBleed.style.opacity = String(clamp(opacity,0,0.92));
}
function showHUD(){
  if(State.meterShown) return;
  State.meterShown=true;
  elHUD.classList.add("visible");
}
function hideHUD(){ elHUD.classList.remove("visible"); }

function buildBars(container,value){
  container.innerHTML="";
  for(let i=0;i<5;i++){
    const b=document.createElement("div");
    b.className="bar"+(i<value?" filled":"");
    container.appendChild(b);
  }
}
function updateMeters(){
  elDriveLabel.textContent=State.labels.drive;
  elFractureLabel.textContent=State.labels.fracture;
  buildBars(elDriveBars, State.drive);
  buildBars(elFractureBars, State.fracture);
}

/* typewriter preserving tags */
let typewriterTimeout=null;
function clearTypewriter(){ if(typewriterTimeout) clearTimeout(typewriterTimeout); typewriterTimeout=null; }


function revealHTML(el, html, done){
  // Line-by-line reveal with fade-in controlled by text speed slider
  const parts = String(html)
    .split(/<br\s*\/?>\s*<br\s*\/?>/i)
    .map(s => s.trim())
    .filter(Boolean);

  el.innerHTML = "";
  let idx = 0;
  const choicesEl = document.getElementById("choiceButtons");

  function addChunk(){
    // add up to two paragraphs
    const chunk = parts.slice(idx, idx+2);
    idx += chunk.length;

    chunk.forEach(p=>{
      const para = document.createElement("p");
      para.className = "para";
      
      // Split paragraph into lines (by <br> tags and natural breaks)
      const lines = p.split(/<br\s*\/?>/i).map(line => line.trim()).filter(Boolean);
      
      // Create line spans
      lines.forEach((line, lineIdx) => {
        const lineSpan = document.createElement("span");
        lineSpan.className = "line fade";
        lineSpan.innerHTML = line;
        para.appendChild(lineSpan);
        
        // Add line break except for last line
        if(lineIdx < lines.length - 1) {
          para.appendChild(document.createElement("br"));
        }
        
        // Stagger the reveal of each line based on text speed
        const baseDelay = 7500; // 7.5 seconds between lines at 1.0x (7-8 second range)
        const speedMultiplier = window.textSpeed || 1;
        const delay = baseDelay / speedMultiplier;
        
        setTimeout(() => {
          requestAnimationFrame(() => lineSpan.classList.add("in"));
        }, lineIdx * delay);
      });
      
      el.appendChild(para);
    });

    // If more to show, display Continue button; otherwise call done.
    choicesEl.innerHTML = "";
    if(idx < parts.length){
      const btn = document.createElement("button");
      btn.className = "continue";
      btn.textContent = "Continue";
      btn.onclick = addChunk;
      choicesEl.appendChild(btn);
      elChoices.classList.add("visible");
    } else {
      if(typeof done === "function") done();
    }
  }

  addChunk();
}


function revealChoices(label, items){
  elChoiceLabel.textContent=label||"";
  elChoiceButtons.innerHTML="";
  items.forEach(c=>{
    const btn=document.createElement("button");
    btn.className="choice";
    btn.innerHTML=c.text;
    btn.addEventListener("click",()=>{
      // Disable button to prevent double-clicks
      btn.disabled = true;
      btn.style.opacity = "0.5";
      
      if(c.fx==="sting" && audioEnabled){
        playAudio(sting);
      }
      c.onSelect && c.onSelect();
    });
    elChoiceButtons.appendChild(btn);
  });
  // MUCH longer delay to ensure all text is done animating
  // At default speed (1.0x), each paragraph can have many lines
  // Use 5 seconds minimum delay
  const delayMs = Math.max(5000, (window.textSpeed ? 5000 / window.textSpeed : 5000));
  setTimeout(() => {
    requestAnimationFrame(()=> elChoices.classList.add("visible"));
  }, delayMs);
}
function hideChoices(){
  elChoices.classList.remove("visible");
  elChoiceButtons.innerHTML="";
}

// Image error handling
function setPortraitWithErrorHandling(src, alt) {
  elPortrait.removeEventListener('error', handlePortraitError);
  
  function handlePortraitError() {
    console.warn(`Portrait image not found: ${src}`);
    elPortrait.style.display = "none";
  }
  
  if(src){
    elPortrait.src = src;
    elPortrait.alt = alt || "Portrait";
    elPortrait.style.display = "block";
    elPortrait.addEventListener('error', handlePortraitError, { once: true });
  } else {
    elPortrait.style.display = "none";
    elPortrait.removeAttribute("src");
  }
}

function endingToneSentence(doc){
  const d=State.drive, f=State.fracture;
  if(d===f) return "";
  const frac=f>d;
  if(doc==="morton") return frac
    ? "By the end, every headline reads like an accusation, every compliment like a theft."
    : "He carries his triumph like a crown, even as it cuts into him.";
  if(doc==="jackson") return frac
    ? "The more he tries to prove the truth, the more the truth becomes a tunnel with no exit."
    : "He keeps returning to the same claim, convinced that persistence will become proof.";
  if(doc==="wells") return frac
    ? "He does not fear pain nearly as much as he fears being forced to feel himself."
    : "He still reaches for vindication, even as the door to absence stands open.";
  return "";
}
function remainLine(doc){
  if(doc==="morton") return "No one is there to witness him as he fades to black one last time.";
  if(doc==="jackson") return "The argument continues, but only inside a skull that can no longer voice it.";
  if(doc==="wells") return "The silence arrives exactly as promised.";
  return "";
}
function escapeHTML(str){
  return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

function bump(which){
  if(which==="drive") State.drive=clamp(State.drive+1,0,5);
  if(which==="fracture") State.fracture=clamp(State.fracture+1,0,5);
  updateMeters();
  if(State.doctor==="wells"){
    setDomeBleed(0.06 + (State.fracture/5)*0.20);
  }
}

function goRemain(doc){
  if(audioEnabled){
    music.volume=0.25;
    setTimeout(()=>{ music.volume=0.55; }, 1800);
  }
  setDomeBleed(0);
  
  // Display remain message then show final choice after a pause
  render({
    location:"After",
    title:"Remain",
    portrait: (doc==="morton")?"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/morton.png":(doc==="jackson")?"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/jackson.png":(doc==="wells")?"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/wells.png":null,
    wash: (doc==="morton")?"var(--wash-amber)":(doc==="jackson")?"var(--wash-blue)":(doc==="wells")?"var(--wash-ash)":null,
    text:`<em>${escapeHTML(remainLine(doc))}</em>`,
    choices:{ label:"", items:[{text:"↩ Return to the Dome — Begin Again", onSelect:()=>go("start")}] }
  });
}

function enterDoctor(doc){
  resetState();
  State.doctor=doc;
  State.drive=2;
  State.fracture=2;
  State.meterShown=false;
  hideHUD();

  if(doc==="morton"){
    State.labels={drive:"Ambition", fracture:"Paranoia"};
    setWash("var(--wash-amber)");
    go("morton-1");
  } else if(doc==="jackson"){
    State.labels={drive:"Recognition", fracture:"Obsession"};
    setWash("var(--wash-blue)");
    go("jackson-1");
  } else if(doc==="wells"){
    State.labels={drive:"Redemption", fracture:"Dissolution"};
    setWash("var(--wash-ash)");
    go("wells-1");
  }
  updateMeters();
  if(audioEnabled){ startAudioOnce(); playAudio(music); }
}

const passages={
  start:{
    location:"Massachusetts General Hospital · Boston · October 16, 1846",
    title:"The Ether Dome",
    portrait:null,
    wash:null,
    text:`The Ether Dome sits like a pale bowl turned upside down on the hospital roof, a chapel built for spectators. The benches are arranged in patient arcs so that nothing can be hidden—no tremor, no plea, no involuntary thrash of muscle as the blade insists. Boston's medical men gather with their students tucked close behind them, hungry to witness suffering because suffering has always been the proof that surgery is real. Pain is the sound that confirms a boundary has been crossed.<br><br>Today, that boundary is about to be negotiated chemically.<br><br>The air is warm with breath and wool. A faint sweetness threads through it—sharp, solvent, almost floral. No one names it with reverence yet. They have come to watch a demonstration. They do not understand they have come to watch the first public permission slip for disappearance.<br><br><em>You are the witness. Choose whose fate you will follow, and the Dome will obligingly reshape its story around your gaze.</em>`,
    choices:{ label:"Whose story will you enter?", items:[
      {text:"William Morton — ambitious, late, reeking of orange oil", onSelect:()=>enterDoctor("morton")},
      {text:"Charles Jackson — the mind behind the idea, furious at erasure", onSelect:()=>enterDoctor("jackson")},
      {text:"Horace Wells — the pioneer the room once mocked", onSelect:()=>enterDoctor("wells")}
    ]}
  },

  "morton-1":{
    location:"The Ether Dome · Demonstration Day",
    title:"Morton's Grand Entrance",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/morton.png",
    wash:"var(--wash-amber)",
    text:`Morton arrives late enough that the room has begun to decide he is absent on purpose, late enough that ridicule has already found its footing and started to stretch its limbs. He moves as if he has not noticed the laughter. He does not apologize. Apology is a kind of surrender, and he has not brought surrender with him.<br><br>His apparatus smells faintly of orange—bright, domestic, absurdly pleasant for a room built to contain screams. He keeps the scent close as though it could make the work seem clean. The patient, Gilbert Abbott, is young enough that the shape of his fear still reads plainly on his face. Straps hold him still in a chair that has seen too many trembling legs.<br><br>Morton raises the inhaler. He has practiced this, not only in the private sense of repetition but in the psychological sense of staging. He knows the room must feel inevitability. He knows the men above him must lean forward before they can be converted. He knows that if he can turn pain into silence in front of them, he will never again be only a dentist with a scheme.<br><br>The cloth touches the patient's face. Abbott breathes in. The ether coils into him like a polite ghost.`,
    choices:{ label:"Decision 1", items:[
      {text:"Proceed with theatrical certainty", onSelect:()=>{bump("drive"); showHUD(); go("morton-2a");}},
      {text:"Slow down, adjust, insist on control", onSelect:()=>{bump("fracture"); showHUD(); go("morton-2b");}}
    ]}
  },
  "morton-2a":{
    location:"The Ether Dome · The First Silence",
    title:"No Humbug",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/morton.png",
    wash:"var(--wash-amber)",
    text:`You do not allow doubt to show. Doubt is contagious. You let the room see confidence the way a gambler lets the table see a calm hand. Abbott's breathing changes. His eyes lose focus. There is a moment—thin, almost invisible—when the body decides whether it will fight. You press through that moment like a man walking through a door he intends to lock behind him.<br><br>Dr. Warren's scalpel descends. Flesh yields. The room expects the eruption of sound, the familiar animal protest of a nervous system insisting on its own survival.<br><br>No scream comes.<br><br>The silence that replaces it is not empty. It is heavy. It lands on the benches like a wet cloth. For one terrifying second the crowd doesn't know how to react, because the script they have rehearsed for years has been broken.<br><br>Then Warren speaks, and his words ring like a gavel: <em>"Gentlemen, this is no humbug."</em><br><br>Applause arrives late, as though it had to find permission. When it comes, it hits Morton in the chest like a drug. He tells himself this is about mercy, about the humane transformation of surgery, about civilization stepping forward. But beneath that polished narrative is a quieter truth he does not examine too closely: relief is noble. Immortality is better. If pain must be silenced for him to be remembered, then let it be silenced.`,
    choices:{ label:"Decision 2", items:[
      {text:"Claim the miracle as yours, publicly and permanently", onSelect:()=>{bump("drive"); go("morton-3");}},
      {text:`Credit "science" and let the room assume the rest`, onSelect:()=>{bump("fracture"); go("morton-3");}}
    ]}
  },
  "morton-2b":{
    location:"The Ether Dome · The First Silence",
    title:"Controlled Breath",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/morton.png",
    wash:"var(--wash-amber)",
    text:`You slow. You check the seal, the cloth, the valve. You can feel the room's impatience sharpening into contempt. They want spectacle, but you want certainty. There is a particular terror in being wrong in public, and you have built your entire life around outrunning it.<br><br>Abbott breathes in. His chest rises. His fingers twitch once, involuntarily, a small rebellion that makes your throat go dry. You correct course, adjust pressure, wait for the body to surrender rather than forcing it to.<br><br>The blade descends. The expected scream doesn't arrive, but the room doesn't celebrate immediately. They watch like wolves deciding if the prey is truly dead.<br><br>Warren speaks the words anyway. The applause comes. It is thinner than it could have been, but it is real. Morton tells himself this is about mercy, about the humane transformation of surgery, about civilization stepping forward. But beneath that polished narrative is a quieter truth he does not examine too closely: relief is noble. Immortality is better.<br><br>And now that the room has seen silence, Morton realizes the most dangerous part is not the surgery—it is the claim that will follow. Silence can be stolen. Credit can be stolen. History can be stolen. He feels competitors materializing around the edges of the Dome like figures in fog.`,
    choices:{ label:"Decision 2", items:[
      {text:"Patent it. Rename it. Make ownership undeniable", onSelect:()=>{bump("drive"); go("morton-3");}},
      {text:"Go to Congress for recognition—force the nation to pay attention", onSelect:()=>{bump("fracture"); go("morton-3");}}
    ]}
  },
  "morton-3":{
    location:"Boston & Washington · Aftermath",
    title:"The Hunger for Credit",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/morton.png",
    wash:"var(--wash-amber)",
    text:`Morton begins to chase the impossible: to own a thing that now belongs to anyone with a bottle and a willingness to use it. He calls it "Letheon," wraps it in orange oil and legal language, and tries to make a law out of a vapor. Each time someone administers ether without paying him, he feels it as theft. Each newspaper that prints another man's name makes him itch with rage.<br><br>The success that made him famous also made him vulnerable. Silence is addictive. So is applause. So is the belief that you have changed the world and the world should keep kneeling.`,
    choices:{ label:"", items:[{text:"Continue →", onSelect:()=>go("morton-end")}] }
  },
  "morton-end":{
    location:"Stockbridge, Massachusetts · 1881",
    title:"The Garden",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/morton.png",
    wash:"var(--wash-amber)",
    text:()=>{const tone=endingToneSentence("morton"); return `Morton cannot afford New York anymore. He moves to Stockbridge, a town where he is nobody. He gardens. He tends to plants with the same methodical attention he once reserved for inhalers and apparatus. His neighbors do not know what he invented. Some of them do not know he is alive.<br><br>He receives a letter one morning in 1881. It informs him that the American Medical Association has finally decided—not to credit him, but to acknowledge that the anesthetic of choice is no longer his. The world has moved on, taking his ether with it. He reads the letter twice, then sets it aside with the kind of calm that accompanies the moment when a man realizes he has already lost.<br><br>${tone?`${tone}<br><br>`:""}His death goes unmentioned in most papers. A medical journal prints his obituary with the word "dentist" and little else.`;},
    choices:{ label:"Final choice", items:[
      {text:"Remain with the body.", onSelect:()=>goRemain("morton")},
      {text:"Return to the Dome.", onSelect:()=>go("epilogue"), fx:"sting"}
    ]}
  },

  "jackson-1":{
    location:"Boston · Charles Jackson's Study · October 1846",
    title:"The Erasure",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/jackson.png",
    wash:"var(--wash-blue)",
    text:`You have been writing for weeks. Letters. Affidavits. Careful, legal descriptions of every conversation you ever had with Crawford Long, with Horace Wells, with the men at Harvard who you believe stole your idea and gave it to Morton. The evidence exists. You have catalogued it carefully. But the problem with paper is that it is not applause.<br><br>You sit in your study and read the accounts from the Dome. Morton's name. Morton's triumph. Your years of research reduced to a footnote in a scandal about stolen ideas. No one was supposed to know it was yours. Everyone was supposed to know it was yours. These facts have become irreconcilable.<br><br>You are right. You can feel the rightness like a stone in your chest. You are right and no one is listening.`,
    choices:{ label:"Decision 1", items:[
      {text:"Write louder. Publish everywhere. Force recognition", onSelect:()=>{bump("drive"); showHUD(); go("jackson-2a");}},
      {text:"Let it go. Step back. Accept the erasure", onSelect:()=>{bump("fracture"); showHUD(); go("jackson-2b");}}
    ]}
  },
  "jackson-2a":{
    location:"Boston & Washington · The Campaign",
    title:"Proof as Weapon",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/jackson.png",
    wash:"var(--wash-blue)",
    text:`You transform the study into a war room. Letters multiply. You send them to newspapers, to Congress, to every man in Boston who might have influence. Each one is written with the precision of someone building a legal case, because it is a legal case—the most important one of your life, even if the only judge is the court of public opinion.<br><br>The problem is that public opinion does not read affidavits. Public opinion prefers narrative to documentation. Everyone loves a story about a dentist's triumph. No one loves a story about a man so obsessed with being right that he has started to seem unhinged by it.`,
    choices:{ label:"Decision 2", items:[
      {text:"Present the dossier to Congress as proof of theft", onSelect:()=>{bump("drive"); go("jackson-3");}},
      {text:"Seek acclaim abroad; force Europe to validate you", onSelect:()=>{bump("fracture"); go("jackson-3");}}
    ]}
  },
  "jackson-2b":{
    location:"Boston · Retreat",
    title:"The Quiet Surrender",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/jackson.png",
    wash:"var(--wash-blue)",
    text:`You gather the letters. You lock them in a drawer. The study grows quiet again, but the quiet is not restful; it is the quiet of a gun left half-cocked. Every morning you wake and feel the stone in your chest. Every afternoon you see a newspaper with Morton's name and feel it again.<br><br>You tell yourself that you have made a choice. That stepping away from the fight is dignified. That history will eventually correct itself. These are the things men say when they have decided that truth is not worth the cost of insisting on it. They are also, sometimes, true.`,
    choices:{ label:"Decision 2", items:[
      {text:"Treat this silence as science: observe, document, learn", onSelect:()=>{bump("drive"); go("jackson-3");}},
      {text:"Treat this silence as defeat: retreat further into isolation", onSelect:()=>{bump("fracture"); go("jackson-3");}}
    ]}
  },
  "jackson-3":{
    location:"Boston · The Long Argument",
    title:"A Mind Built for Combat",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/jackson.png",
    wash:"var(--wash-blue)",
    text:`Your letters multiply. Your tone sharpens. The language becomes the weapon and then becomes the cage. The more you write, the less you can stop writing. The world moves forward anyway, and your claim becomes the background hum of progress: persistent, irritating, easily ignored.<br><br>Without the struggle over credit, you have no architecture for your mind to inhabit. Even victory feels like being left alone in a room with your own insistence.`,
    choices:{ label:"", items:[{text:"Continue →", onSelect:()=>go("jackson-end")}] }
  },
  "jackson-end":{
    location:"McLean Hospital · Belmont, Massachusetts · 1873–1880",
    title:"The Guest at McLean",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/jackson.png",
    wash:"var(--wash-blue)",
    text:()=>{const tone=endingToneSentence("jackson"); return `Rumor places Jackson at Morton's grave, reading the tombstone inscription with the kind of stare people reserve for betrayal. Whether he was truly there does not matter; what matters is that the story fits. He seizes. He collapses. He is admitted to McLean, cared for by a medical community that respects his brilliance even as it quietly locks him away from public argument.<br><br>Then a stroke takes his language—his only weapon. He tries to form the sentence one more time. "I was right." The grammar dissolves before it can assemble. The thought survives, but it has no mouth.${tone?`<br><br>${tone}`:""}<br><br>He lives quietly, declining, until 1880. No one argues with him. There is nothing left to argue about.`;},
    choices:{ label:"Final choice", items:[
      {text:"Remain with the body.", onSelect:()=>goRemain("jackson")},
      {text:"Return to the Dome.", onSelect:()=>go("epilogue"), fx:"sting"}
    ]}
  },

  "wells-1":{
    location:"Hartford, Connecticut · 1844",
    title:"Before the Dome",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/wells.png",
    wash:"var(--wash-ash)",
    text:`Wells saw it first. He watched a man under nitrous oxide injure himself without noticing, and the future opened like a crack in the wall. The next day he had his own tooth pulled under gas and felt nothing. It was not a trick. It was not theater. It was mercy, real and immediate, and Wells believed he had touched something holy: the possibility of opening the body without torturing the mind.<br><br>Then his public demonstration failed. A cry. A laugh. A chorus of students calling him humbug. The word stuck to him the way soot sticks to a ceiling. He carried it back to Hartford like a bruise that never resolved.<br><br>When ether succeeds in the Dome, Wells doesn't feel vindicated. He feels replaced. He feels like the world has taken his discovery, polished it, and handed it to someone louder.<br><br>What he learns in the years after is not merely scientific. It is personal. He learns what oblivion feels like. Not sleep. Not death. Something else: a controlled evacuation of self.`,
    choices:{ label:"Decision 1", items:[
      {text:"Try again publicly; force redemption into the open", onSelect:()=>{bump("drive"); showHUD(); go("wells-2a");}},
      {text:"Withdraw; experiment privately; chase relief without witnesses", onSelect:()=>{bump("fracture"); showHUD(); go("wells-2b");}}
    ]}
  },
  "wells-2a":{
    location:"Boston & Hartford · Aftermath",
    title:"The Reach for Redemption",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/wells.png",
    wash:"var(--wash-ash)",
    text:`You pursue redemption the way a drowning man pursues air. You write. You travel. You place yourself back in rooms that smell like judgment and hope the world will revise its laughter. Each attempt brings you closer to the feeling you want: the moment where the audience looks at you and realizes they were wrong.<br><br>But the world is already moving. Ether has become the headline. Your name has become a footnote. The harder you push toward recognition, the more you feel yourself thinning. You begin to crave the one place where failure cannot reach you: the soft-edged quiet inside anesthesia.`,
    choices:{ label:"Decision 2", items:[
      {text:"Treat chloroform as research; observe yourself clinically", onSelect:()=>{bump("drive"); go("wells-3");}},
      {text:"Treat chloroform as refuge; seek silence from shame", onSelect:()=>{bump("fracture"); go("wells-3");}}
    ]}
  },
  "wells-2b":{
    location:"New York · Private Rooms",
    title:"A Door Out of Feeling",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/wells.png",
    wash:"var(--wash-ash)",
    text:`You withdraw because crowds have learned your face. You withdraw because laughter has a way of waiting in corners, ready to greet you. You tell yourself solitude will allow focus. You tell yourself privacy is a laboratory condition. But what you are really doing is building a private door out of feeling.<br><br>Chloroform becomes familiar. First an object of study. Then a companion. Then a requirement. Under its influence, humiliation loosens. The past becomes distant. The nervous system is quieted, and quiet begins to feel like morality.<br><br>You begin to realize something no one in the Dome understood: anesthesia is not just the removal of pain. It is the voluntary suspension of being present.`,
    choices:{ label:"Decision 2", items:[
      {text:"Keep control: study the effects, measure, document", onSelect:()=>{bump("drive"); go("wells-3");}},
      {text:"Let go: seek oblivion, not as escape but as practice", onSelect:()=>{bump("fracture"); go("wells-3");}}
    ]}
  },
  "wells-3":{
    location:"New York City · 1847–1848",
    title:"Rehearsing Absence",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/wells.png",
    wash:"var(--wash-ash)",
    text:`You try to turn the gas into science again. You try to convince yourself that discipline can separate the chemical from the hunger it creates. But each time you inhale, you feel the same perverse relief: the temporary absence of self. The body becomes manageable. The mind becomes distant. The world becomes muted.<br><br>You understand, too late, that the Dome did not merely change surgery. It introduced an option into human life: that consciousness can be stepped away from on purpose. You have been practicing that step for months. Years.`,
    choices:{ label:"", items:[{text:"Continue →", onSelect:()=>go("wells-end")}] }
  },
  "wells-end":{
    location:"A Jail Cell · New York · January 24, 1848",
    title:"Letters to Those He Loved",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/wells.png",
    wash:"var(--wash-ash)",
    text:()=>{
      const op=0.18 + (State.fracture/5)*0.62;
      setDomeBleed(op);
      const tone=endingToneSentence("wells");
      return `In January 1848, under chloroform, you do something that will be described later as madness. Acid thrown at strangers. A face ruined. An arrest. Bond set high. The story becomes scandal, and scandal becomes confirmation for the people who always wanted you to be a fraud. You are allowed one courtesy before the cell door closes: to retrieve your toiletries, your bag, your personal effects. Civilization offering a final politeness.<br><br>In the cell, you write letters that do not look like panic. You write with a strange calm, as if you have already stepped away from the future. Your hand does not shake. Your words are lucid. That lucidity is the worst part. You do not collapse into chaos; you arrange it.<br><br>Then you do what you have been practicing: you remove yourself.<br><br>Each inhalation over the past months was a rehearsal. Each private experiment was a quiet vote for retreat. You learned the exact interval between consciousness and its soft surrender. You learned how long the body fights before it stops insisting. The cell is not an origin point; it is a culmination. The door you are about to walk through was built in the Ether Dome years ago. You have simply been practicing the handle.<br><br>You pour chloroform into fabric, pack it to your face, bind it there with methodical knots. You understand the chemistry. You understand the timeline. You understand, with clinical clarity, what it means to be present and then not present. The body still exists. The body can be cut. The nervous system can be quieted. The mind can retreat.<br><br>This is the explicit horror: the Dome did not only teach physicians how to silence pain. It taught human beings that they can choose to step outside themselves and call it mercy.<br><br>Your razor opens flesh. The darkness arrives like anesthesia. The last sensation is not agony. It is relief.${tone?`<br><br>${tone}`:""}<br><br>And somewhere, years away, the Ether Dome stands unchanged, its pale curvature indifferent and watchful. As your vision narrows, the shape of that ceiling overlays the darkness behind your eyes. The architecture returns—not as memory, but as structure. The room that first demonstrated the disappearance of pain becomes the room in which you finally disappear yourself.`;
    },
    choices:{ label:"Final choice", items:[
      {text:"Remain with the body.", onSelect:()=>goRemain("wells")},
      {text:"Return to the Dome.", onSelect:()=>go("epilogue"), fx:"sting"}
    ]}
  },

  epilogue:{
    location:"The Ether Dome · After",
    title:"The Architecture of Silence",
    portrait:"https://faemayhem.github.io/Ether-Dome-Twine-/assets/img/dome.png",
    wash:null,
    text:`The Ether Dome empties. Boots descend the stairs. Coats sweep the air clean. The chair remains. The architecture remains. The room holds the faint sweetness of ether as though it has soaked into plaster. If you stand there long enough, you can imagine the sound that should have happened and did not.<br><br>The first time a body chose unconsciousness in the name of mercy, humanity discovered something that extends far beyond surgery: consciousness can be suspended voluntarily, without death, without sleep, without the narrative closure that usually accompanies absence. Pain was not defeated; it was bypassed. The self was not destroyed; it was set aside.<br><br>The demonstration became a triumph. The triumph became a tool. The tool became a habit. And the habit outlived the men who fought to own it.<br><br><em>The door opened in this room did not close when the surgery ended. It never has.</em>`,
    choices:{ label:"", items:[{text:"↩ Return to the Dome — Begin Again", onSelect:()=>go("start")}] }
  }
};

function go(key){
  if(!["wells-2a","wells-2b","wells-3","wells-end"].includes(key)) setDomeBleed(0);
  const p=passages[key]; if(!p) return; render(p);
}

function render(p){
  hideChoices();
  elLocation.textContent=p.location||"";
  elTitle.textContent=p.title||"";
  
  setPortraitWithErrorHandling(p.portrait, p.title||"Portrait");
  
  if(p.wash) setWash(p.wash); else setWash(null);

  updateMeters();
  if(State.meterShown && !elHUD.classList.contains("visible")) {
    elHUD.classList.add("visible");
  }

  const html = (typeof p.text==="function") ? p.text() : p.text;
  const ch = p.choices || {label:"", items:[]};

  revealHTML(elText, html||"", ()=>{
    setTimeout(()=>revealChoices(ch.label||"", ch.items||[]), 240 / (window.textSpeed || 1));
  });
}

function boot(){
  resetState();
  updateMeters();
  hideHUD();
  go("start");
}
boot();
</script>
</body>
</html>
